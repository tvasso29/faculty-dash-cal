<!DOCTYPE html>
<html>
<head>
  <style>button {
  padding: 6px 12px;
  margin-right: 4px;
  border: 1px solid #ccc;
  background: #f3f3f3;
  cursor: pointer;
  border-radius: 4px;
}

button.active {
  background: #1a73e8;
  color: white;
  border-color: #1a73e8;
}</style>
<div style="margin-bottom:8px;">
  <button id="btnToday" onclick="showToday()">Today</button>
  <button id="btnTomorrow" onclick="showTomorrow()">Tomorrow</button>
</div>

<h4>Out</h4>
<ul id="outList"></ul>

<h4>Coverage</h4>
<ul id="coverList"></ul>
</head>

<body>
<div style="margin-bottom:8px;">
  <button id="btnToday" onclick="showToday()">Today</button>
  <button id="btnTomorrow" onclick="showTomorrow()">Tomorrow</button>
</div>

<h4>Out</h4>
<ul id="outList"></ul>

<h4>Coverage</h4>
<ul id="coverList"></ul>

</body>
  <script>
var icsUrl = "https://calendar.google.com/calendar/ical/c_c0efeb6a7b5178f23b479e66b826d463bd8b94ece71ff575678dfa1f75e7d1ed%40group.calendar.google.com/public/basic.ics";

var todayOut = [];
var tomorrowOut = [];
var todayCover = [];

function key(d) {
  return d.getFullYear() +
    ("0"+(d.getMonth()+1)).slice(-2) +
    ("0"+d.getDate()).slice(-2);
}

var today = new Date();
var tomorrow = new Date();
tomorrow.setDate(today.getDate()+1);

var todayKey = key(today);
var tomorrowKey = key(tomorrow);

fetch(icsUrl)
  .then(r => r.text())
  .then(text => {
    var events = text.split("BEGIN:VEVENT").slice(1);

    events.forEach(e => {
      var summary = e.match(/SUMMARY:(.*)/);
      var start = e.match(/DTSTART[^:]*:(\d{8})/);
      var end = e.match(/DTEND[^:]*:(\d{8})/);

      if (!summary || !start) return;

      var title = summary[1].replace(/\\n/g,"").trim();
      var startDate = start[1];
      var endDate = end ? end[1] : startDate;

      // Coverage: name present, not a sub
      var namePattern = /[A-Z][a-z]+ [A-Z][a-z]+/;
      var isCoverage = namePattern.test(title) && !title.includes("[");

      if (isCoverage && startDate === todayKey) {
        todayCover.push(title);
        return;
      }

      // PTO
      var subMatch = title.match(/\[(.*?)\]/);
      var subText = subMatch ? " â€” Sub: " + subMatch[1] : " â€” No Sub";
      var cleanTitle = title.replace(/\[.*?\]/, "").trim();

      if (todayKey >= startDate && todayKey < endDate) {
        todayOut.push(cleanTitle + subText);
      }
      if (tomorrowKey >= startDate && tomorrowKey < endDate) {
        tomorrowOut.push(cleanTitle + subText);
      }
    });

    showToday();
  });

function render(list, id, emptyText) {
  var ul = document.getElementById(id);
  ul.innerHTML = "";

  if (list.length === 0) {
    ul.innerHTML = "<li>" + emptyText + "</li>";
    return;
  }

  list.forEach(item => {
    var li = document.createElement("li");
    li.textContent = item;
    ul.appendChild(li);
  });
}

function showToday() {
  render(todayOut, "outList", "No one is out ðŸŽ‰");
  render(todayCover, "coverList", "No coverage today");
  setActive("btnToday");
}

function showTomorrow() {
  render(tomorrowOut, "outList", "No one is out");
  document.getElementById("coverList").innerHTML =
    "<li>Coverage shown for today only</li>";
  setActive("btnTomorrow");
}

function setActive(id) {
  document.getElementById("btnToday").classList.remove("active");
  document.getElementById("btnTomorrow").classList.remove("active");
  document.getElementById(id).classList.add("active");
}
</script>
</html>

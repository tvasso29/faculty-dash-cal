<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <style>
    :root {
      --accent: #0b3c5d;      /* change to match school color */
      --bg: #ffffff;
      --border: #e5e7eb;
      --muted: #6b7280;
      --title: #111827;
    }

    body {
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 12px;
      background: transparent;
    }
.widget-title {
  font-size: 16px;
  font-weight: 700;
  color: var(--accent);
  margin-bottom: 10px;
  padding-bottom: 6px;
  border-bottom: 1px solid var(--border);
}
    .card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-left: 4px solid var(--accent);
      border-radius: 8px;
      padding: 12px 14px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
      max-width: 320px;
    }

    .section {
      margin-bottom: 14px;
    }

    .section:last-child {
      margin-bottom: 0;
    }

    .section h4 {
      margin: 0 0 6px 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--title);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    li {
      font-size: 14px;
      padding: 6px 8px;
      border-radius: 6px;
      background: #f9fafb;
      margin-bottom: 6px;
    }

    li:last-child {
      margin-bottom: 0;
    }

    .empty {
      color: var(--muted);
      font-style: italic;
      background: none;
      padding-left: 2px;
    }
  </style>
</head>

<body>
<div class="widget-title">Faculty / Staff Time Off</div>
<div class="card">
  <div class="section">
    <h4>Today</h4>
    <ul id="todayList"><li class="empty">Loading…</li></ul>
  </div>

  <div class="section">
    <h4>Tomorrow</h4>
    <ul id="tomorrowList"><li class="empty">Loading…</li></ul>
  </div>
</div>

<script>
const icsUrl =
  "https://api.allorigins.win/raw?url=" +
  encodeURIComponent(
    "https://calendar.google.com/calendar/ical/c_c0efeb6a7b5178f23b479e66b826d463bd8b94ece71ff575678dfa1f75e7d1ed%40group.calendar.google.com/public/basic.ics"
  );

function dateKey(date) {
  return date.getFullYear() +
    ("0" + (date.getMonth() + 1)).slice(-2) +
    ("0" + date.getDate()).slice(-2);
}

const today = new Date();
const tomorrow = new Date();
tomorrow.setDate(today.getDate() + 1);

const todayKey = dateKey(today);
const tomorrowKey = dateKey(tomorrow);

fetch(icsUrl)
  .then(res => res.text())
  .then(text => {
    const events = text.split("BEGIN:VEVENT").slice(1);

    const todayEvents = [];
    const tomorrowEvents = [];

    events.forEach(e => {
      const summary = e.match(/SUMMARY:(.*)/);
      const startMatch = e.match(/DTSTART[^:]*:(\d{8})/);
      const endMatch = e.match(/DTEND[^:]*:(\d{8})/);

      if (!summary || !startMatch) return;

      const title = summary[1].replace(/\\n/g, "").trim();
      const start = startMatch[1];
      const end = endMatch ? endMatch[1] : start;

      if (todayKey >= start && todayKey < end) {
        todayEvents.push(title);
      }

      if (tomorrowKey >= start && tomorrowKey < end) {
        tomorrowEvents.push(title);
      }
    });

    render(todayEvents, "todayList", "No staff PTO today");
    render(tomorrowEvents, "tomorrowList", "No staff PTO tomorrow");
  });

function render(list, id, emptyText) {
  const ul = document.getElementById(id);
  ul.innerHTML = "";

  if (list.length === 0) {
    ul.innerHTML = `<li class="empty">${emptyText}</li>`;
    return;
  }

  list.forEach(item => {
    const li = document.createElement("li");
    li.textContent = item;
    ul.appendChild(li);
  });
}
</script>

</body>
</html>

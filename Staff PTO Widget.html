<!DOCTYPE html>
<html>
<head>
  <style>button {
  padding: 6px 12px;
  margin-right: 4px;
  border: 1px solid #ccc;
  background: #f3f3f3;
  cursor: pointer;
  border-radius: 4px;
}

button.active {
  background: #1a73e8;
  color: white;
  border-color: #1a73e8;
}</style>
<div style="margin-bottom:8px;">
  <button id="btnToday" onclick="showToday()">Today</button>
  <button id="btnTomorrow" onclick="showTomorrow()">Tomorrow</button>
</div>

<ul id="ptoList">Loadingâ€¦</ul>
</head>

<body>

<h3>Whoâ€™s Out Today</h3>
<ul id="today">Loadingâ€¦</ul>

<h3>Whoâ€™s Out Tomorrow</h3>
<ul id="tomorrow">Loadingâ€¦</ul>

<script>
var icsUrl = "https://calendar.google.com/calendar/ical/c_c0efeb6a7b5178f23b479e66b826d463bd8b94ece71ff575678dfa1f75e7d1ed%40group.calendar.google.com/public/basic.ics";

var todayEvents = [];
var tomorrowEvents = [];

function dateKey(d) {
  return d.getFullYear().toString() +
    ("0" + (d.getMonth()+1)).slice(-2) +
    ("0" + d.getDate()).slice(-2);
}

var today = new Date();
var tomorrow = new Date();
tomorrow.setDate(today.getDate() + 1);

var todayKey = dateKey(today);
var tomorrowKey = dateKey(tomorrow);

fetch(icsUrl)
  .then(r => r.text())
  .then(text => {
    var events = text.split("BEGIN:VEVENT").slice(1);

    events.forEach(e => {
      var summary = e.match(/SUMMARY:(.*)/);
      var start = e.match(/DTSTART[^:]*:(\d{8})/);
      var end = e.match(/DTEND[^:]*:(\d{8})/);

      if (!summary || !start) return;

      var title = summary[1].replace(/\\n/g,"").trim();
      var startDate = start[1];
      var endDate = end ? end[1] : startDate;

      var subMatch = title.match(/\[(.*?)\]/);
      var subText = subMatch ? " â€” Sub: " + subMatch[1] : " â€” No Sub";
      var cleanTitle = title.replace(/\[.*?\]/, "").trim();

      if (todayKey >= startDate && todayKey < endDate) {
        todayEvents.push(cleanTitle + subText);
      }
      if (tomorrowKey >= startDate && tomorrowKey < endDate) {
        tomorrowEvents.push(cleanTitle + subText);
      }
    });

    showToday();
  });

function render(list) {
  var ul = document.getElementById("ptoList");
  ul.innerHTML = "";

  if (list.length === 0) {
    ul.innerHTML = "<li>No one is out ðŸŽ‰</li>";
    return;
  }

  list.forEach(item => {
    var li = document.createElement("li");
    li.textContent = item;
    ul.appendChild(li);
  });
}

function showToday() {
  render(todayEvents);
  setActive("btnToday");
}

function showTomorrow() {
  render(tomorrowEvents);
  setActive("btnTomorrow");
}

function setActive(id) {
  document.getElementById("btnToday").classList.remove("active");
  document.getElementById("btnTomorrow").classList.remove("active");
  document.getElementById(id).classList.add("active");
}
</script>

</body>
</html>

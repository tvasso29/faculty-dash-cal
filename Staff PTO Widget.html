<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 10px;
    }

    button {
      padding: 6px 12px;
      margin-right: 4px;
      border: 1px solid #ccc;
      background: #f3f3f3;
      cursor: pointer;
      border-radius: 4px;
    }

    button.active {
      background: #1a73e8;
      color: white;
      border-color: #1a73e8;
    }

    ul {
      margin-top: 6px;
      padding-left: 18px;
    }
  </style>
</head>

<body>

<div style="margin-bottom:8px;">
  <button id="btnToday" onclick="showToday()">Today</button>
  <button id="btnTomorrow" onclick="showTomorrow()">Tomorrow</button>
</div>

<ul id="eventList">Loadingâ€¦</ul>

<script>
var icsUrl = "https://calendar.google.com/calendar/ical/c_c0efeb6a7b5178f23b479e66b826d463bd8b94ece71ff575678dfa1f75e7d1ed%40group.calendar.google.com/public/basic.ics";

var todayEvents = [];
var tomorrowEvents = [];

function key(d) {
  return d.getFullYear() +
    ("0" + (d.getMonth()+1)).slice(-2) +
    ("0" + d.getDate()).slice(-2);
}

var today = new Date();
var tomorrow = new Date();
tomorrow.setDate(today.getDate() + 1);

var todayKey = key(today);
var tomorrowKey = key(tomorrow);

fetch(icsUrl)
  .then(r => r.text())
  .then(text => {
    var events = text.split("BEGIN:VEVENT").slice(1);

    events.forEach(e => {
      var summary = e.match(/SUMMARY:(.*)/);
      var start = e.match(/DTSTART[^:]*:(\d{8})/);
      var end = e.match(/DTEND[^:]*:(\d{8})/);

      if (!summary || !start) return;

      var title = summary[1].replace(/\\n/g,"").trim();
      var startDate = start[1];
      var endDate = end ? end[1] : startDate;

      if (todayKey >= startDate && todayKey < endDate) {
        todayEvents.push(title);
      }

      if (tomorrowKey >= startDate && tomorrowKey < endDate) {
        tomorrowEvents.push(title);
      }
    });

    showToday();
  });

function render(list) {
  var ul = document.getElementById("eventList");
  ul.innerHTML = "";

  if (list.length === 0) {
    ul.innerHTML = "<li>No events</li>";
    return;
  }

  list.forEach(item => {
    var li = document.createElement("li");
    li.textContent = item;
    ul.appendChild(li);
  });
}

function showToday() {
  render(todayEvents);
  setActive("btnToday");
}

function showTomorrow() {
  render(tomorrowEvents);
  setActive("btnTomorrow");
}

function setActive(id) {
  document.getElementById("btnToday").classList.remove("active");
  document.getElementById("btnTomorrow").classList.remove("active");
  document.getElementById(id).classList.add("active");
}
</script>

</body>
</html>

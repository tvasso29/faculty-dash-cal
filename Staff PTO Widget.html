<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 10px;
    }

    h4 {
      margin-bottom: 4px;
    }

    ul {
      margin-top: 4px;
      padding-left: 18px;
    }
  </style>
</head>

<body>

<h4>Today</h4>
<ul id="todayList">Loading…</ul>

<h4>Tomorrow</h4>
<ul id="tomorrowList">Loading…</ul>

<script>
const icsUrl =
  "https://api.allorigins.win/raw?url=" +
  encodeURIComponent(
    "https://calendar.google.com/calendar/ical/c_c0efeb6a7b5178f23b479e66b826d463bd8b94ece71ff575678dfa1f75e7d1ed%40group.calendar.google.com/public/basic.ics"
  );

function dateKey(date) {
  return date.getFullYear() +
    ("0" + (date.getMonth() + 1)).slice(-2) +
    ("0" + date.getDate()).slice(-2);
}

const today = new Date();
const tomorrow = new Date();
tomorrow.setDate(today.getDate() + 1);

const todayKey = dateKey(today);
const tomorrowKey = dateKey(tomorrow);

fetch(icsUrl)
  .then(res => res.text())
  .then(text => {
    const events = text.split("BEGIN:VEVENT").slice(1);

    const todayEvents = [];
    const tomorrowEvents = [];

    events.forEach(e => {
      const summary = e.match(/SUMMARY:(.*)/);
      const startMatch = e.match(/DTSTART[^:]*:(\d{8})/);
      const endMatch = e.match(/DTEND[^:]*:(\d{8})/);

      if (!summary || !startMatch) return;

      const title = summary[1].replace(/\\n/g, "").trim();
      const start = startMatch[1];
      const end = endMatch ? endMatch[1] : start;

      // Inclusive range handling for all-day events
      if (todayKey >= start && todayKey < end) {
        todayEvents.push(title);
      }

      if (tomorrowKey >= start && tomorrowKey < end) {
        tomorrowEvents.push(title);
      }
    });

    render(todayEvents, "todayList", "No events today");
    render(tomorrowEvents, "tomorrowList", "No events tomorrow");
  });

function render(list, id, emptyText) {
  const ul = document.getElementById(id);
  ul.innerHTML = "";

  if (list.length === 0) {
    ul.innerHTML = `<li>${emptyText}</li>`;
    return;
  }

  list.forEach(item => {
    const li = document.createElement("li");
    li.textContent = item;
    ul.appendChild(li);
  });
}
</script>

</body>
</html>
